# :kivy 1.10.0

#:import SlideTransition kivy.uix.screenmanager.SlideTransition
#:import RecycleView kivy.uix.recycleview
#:import QRCodeWidget kivy_garden.qrcode
# import ZbarQrcodeDetector android-zbar-qrcode.main
#:import ak asynckivy
#:import asyncio asyncio
#:import MDDropdownMenu kivymd.uix.menu.MDDropdownMenu
#:import MDNavigationLayout kivymd.uix.navigationdrawer.navigationdrawer.MDNavigationLayout




<Tab>
    MDLabel:
        text: root.content_text
        pos_hint: {"center_x": .5, "center_y": .5}

<UTXOListItem>:
    on_release: self.open_utxo_menu()

<TxInputListItem>:
    on_release: print("TxInputListItem")



<BalanceListItem>:
    #on_release: self.on_release()
    IconLeftConfirmationWidget:
        icon: self.parent.parent.icon

<AddressListItem>:
    #on_release: self.on_release()
    IconLeftConfirmationWidget:
        icon: self.parent.parent.icon


<PassphraseControlField>:
    size_hint_y: None
    height: pass_field.height
    text: pass_field.text
    MDTextField:
        id: pass_field
        text: root.text
        color_mode: "accent"
        password: True
        hint_text: "Passphrase"
        write_tab: False
        required: True
        font_size: '21sp'
        on_text: app.check_entropy()
    MDIconButton:
        icon: "eye-off"
        theme_icon_color: "Custom"
        icon_color: "#cccccc"
        pos_hint: {"center_y": .5}
        pos: pass_field.width - self.width + dp(8), 0
        on_release:
            self.icon = "eye" if self.icon == "eye-off" else "eye-off"
            pass_field.password = False if pass_field.password is True else True

<QRScanAddressField>:
    size_hint_y: None
    height: address_input.height
    text: address_input.text
    MDTextField:
        id: address_input
        text: root.text
        color_mode: "accent"
        #hint_text: "Enter Address"
        helper_text_mode: "persistent"
        helper_text: "Enter Address"
        write_tab: False
        on_text: app.set_address_error(self.text)
        on_text_validate: app.set_address_error(self.text)
        on_focus: app.set_address_error(self.text)
    MDIconButton:
        icon: "qrcode-scan"
        theme_icon_color: "Custom"
        icon_color: "#cccccc"
        pos_hint: {"center_y": .5}
        pos: address_input.width - self.width + dp(8), 0
        on_release: app.start_qr_scanner()



#MDTextField:
#    id: address_input
#    helper_text: "Enter Address"
#    helper_text_mode: "persistent"
#    color_mode: "accent"
#    write_tab: False
#    on_text: app.set_address_error(self.text)
#    on_text_validate: app.set_address_error(self.text)
#    on_focus: app.set_address_error(self.text)

MDScreen:
    BoxLayout:
        orientation: "vertical"
        MDTopAppBar:
            id: toolbar
            title: "Brainbow"
            pos_hint: {"top": 1}
            md_bg_color: "#252525"
            #anchor_title: "center"
            #icon: "fingerprint"
            left_action_items: [["brightness-2", lambda x: app.switch_theme_handler()]]
            #["moon-waxing-crescent", lambda x: app.onboarding_menu_handler()]] if app.is_darkmode else  [["white-balance-sunny", lambda x: app.onboarding_menu_handler()]]
            # left_action_items: [['menu', lambda x: root.ids.nav_drawer.set_state("open")]]

            #left_action_items: [["menu", lambda x: app.nav_drawer_handler()]]
            right_action_items: [["hand-wave-outline", lambda x: app.onboarding_menu_handler()]]
                                    # brightness-2 white-balance-sunny
        Widget:
    MDNavigationLayout:
        x: toolbar.height
        size_hint_y: 1.0 - toolbar.height/root.height
        MDScreenManager:
            id: sm
            transition: SlideTransition(direction="right", duration=0.01)
            WelcomeScreen:
                MDFloatLayout:
                    #md_bg_color : 1, 1, 1, 1
                Carousel:
                    #name: "caraousel"
                    id: caraousel
                    use_pagination: True
                    on_current_slide: app.current_slide(self.index)
                    MDFloatLayout:
                        FitImage:
                            source: "assets/dark-onboarding_00.png"
                            pos_hint: {"center_x": .5, "center_y": .7}
                            size_hint: .42, .42
                        MDLabel:
                            text: "[b]Welcome to Brainbow[/b]"
                            markup: True
                            pos_hint: {"center_y": .485}
                            halign: "center"
                            font_size: "25sp"
                            color: rgba(1, 3, 23, 225)
                        MDLabel:
                            margin: "8dp"
                            pos_hint: {"center_y": .31}
                            opacity: 0.95
                            halign: 'center'
                            font_size: '16sp'
                            text: "Brainbow is a stateless, non-custodial,\ndeterministic Bitcoin wallet.\n\nStateless means, that Brainbow does\nnot save or store your private key\nor wallet information anywhere.\n\nConnect to Bitcoin by generating your wallet\nusing a salt and a really good passphrase."


                        MDTextButton:
                            text: "SKIP AND CONNECT TO BITCOIN"
                            font_size: '18sp'
                            text_color: "black"
                            pos_hint: {"center_x": .5, "center_y": .115}
                            halign: "center"
                            color: "#c9c9c9"
                            on_release: app.goto_slide('login')
                        MDLabel:
                            text: "– of –"
                            pos_hint: {"center_y": .055}
                            halign: "center"
                            font_size: "14sp"
                            color: "#c9c9c9"


                    MDFloatLayout:
                        Image:
                            source: "assets/dark-onboarding_10.png"
                            pos_hint: {"center_x": .5, "center_y": .7}
                            size_hint: .66, .66
                            #size_hint: .42, .42
                        MDLabel:
                            text: "[b]Access your wallet[/b]"
                            markup: True
                            #pos_hint: {"center_y": .58}
                            pos_hint: {"center_y": .485}
                            halign: "center"
                            font_size: "25sp"
                            color: rgba(1, 3, 23, 225)
                        MDLabel:
                            margin: "8dp"
                            pos_hint: {"center_y": .34}
                            opacity: 0.95
                            halign: 'center'
                            font_size: '16sp'
                            text: "To access a wallet, it requires credentials.\n\nOne part of the credentials is a salt and the\nother part is a really good passphrase."
                        MDTextButton:
                            text: "SKIP AND CONNECT TO BITCOIN"
                            font_size: '18sp'
                            text_color: "black"
                            pos_hint: {"center_x": .5, "center_y": .136}
                            halign: "center"
                            color: "#c9c9c9"
                            on_release: app.goto_slide('login')
                        MDLabel:
                            text: "– of –"
                            pos_hint: {"center_y": .055}
                            halign: "center"
                            font_size: "14sp"
                            color: "#c9c9c9"


                    MDFloatLayout:
                        Image:
                            source: "assets/dark-onboarding_20.png"
                            pos_hint: {"center_x": .5, "center_y": .7}
                            size_hint: .66, .66
                            #size_hint: .42, .42
                        MDLabel:
                            text: "[b]Protect your wallet[/b]"
                            markup: True
                            #pos_hint: {"center_y": .58}
                            pos_hint: {"center_y": .485}
                            halign: "center"
                            font_size: "25sp"
                            color: rgba(1, 3, 23, 225)
                        MDLabel:
                            margin: "8dp"
                            pos_hint: {"center_y": .34}
                            opacity: 0.95
                            halign: 'center'
                            font_size: '16sp'
                            text: "Everybody who knows the credentials has\naccess to the wallet and can spend your funds."
                        MDTextButton:
                            text: "SKIP AND CONNECT TO BITCOIN"
                            font_size: '18sp'
                            text_color: "black"
                            pos_hint: {"center_x": .5, "center_y": .136}
                            halign: "center"
                            color: "#c9c9c9"
                            on_release: app.goto_slide('login')
                        MDLabel:
                            text: "– of –"
                            pos_hint: {"center_y": .055}
                            halign: "center"
                            font_size: "14sp"
                            color: "#c9c9c9"

                    MDFloatLayout:
                        name: "salt_is"
                        Image:
                            source: "assets/dark-what-salt-is.png"
                            pos_hint: {"center_x": .5, "center_y": .7}
                            size_hint: .66, .66


                            #size_hint: .42, .42
                        MDLabel:
                            text: "[b]What salt is[/b]"
                            markup: True
                            pos_hint: {"center_y": .485}
                            halign: "center"
                            font_size: "25sp"
                            color: rgba(1, 3, 23, 225)
                        MDLabel:
                            margin: "8dp"
                            pos_hint: {"center_y": .34}
                            opacity: 0.95
                            halign: 'center'
                            font_size: '16sp'
                            #text: "Accessing a wallet requires a salt and a passphrase.\n\n
                            # As passphrase you can choose many random words\nor a sentence. Never use it for anything else.
                            text: "As salt can be names, email addresses, nick-\nnames, identifiers, … ideally with an extension.\n\nExamples: satoshin@gmx.com, run-away-hal,\nHoneyBadger21, Xavier Fiechter, gutenberg, …"
                        MDTextButton:
                            text: "SKIP AND CONNECT TO BITCOIN"
                            font_size: '18sp'
                            text_color: "black"
                            pos_hint: {"center_x": .5, "center_y": .136}
                            halign: "center"
                            color: "#c9c9c9"
                            on_release: app.goto_slide('login')
                        MDLabel:
                            text: "– of –"
                            pos_hint: {"center_y": .055}
                            halign: "center"
                            font_size: "14sp"
                            color: "#c9c9c9"

                    MDFloatLayout:
                        Image:
                            source: "assets/dark-strong_passphrase.png"
                            pos_hint: {"center_x": .5, "center_y": .7}
                            size_hint: .66, .66
                            #size_hint: .42, .42
                        MDLabel:
                            text: "[b]What a passphrase is[/b]"
                            markup: True
                            #pos_hint: {"center_y": .58}
                            pos_hint: {"center_y": .485}
                            halign: "center"
                            font_size: "25sp"
                            color: rgba(1, 3, 23, 225)
                        MDLabel:
                            margin: "8dp"
                            pos_hint: {"center_y": .34}
                            opacity: 0.95
                            halign: 'center'
                            font_size: '16sp'
                            text: "As passphrase you can choose many\nrandom words or a sentence.\n\nNever use it for anything else.\n\nExamples: correct horse battery staple, …"
                        MDTextButton:
                            text: "SKIP AND CONNECT TO BITCOIN"
                            font_size: '18sp'
                            text_color: "black"
                            pos_hint: {"center_x": .5, "center_y": .136}
                            halign: "center"
                            color: "#c9c9c9"
                            on_release: app.goto_slide('login')
                        MDLabel:
                            text: "– of –"
                            pos_hint: {"center_y": .055}
                            halign: "center"
                            font_size: "14sp"
                            color: "#c9c9c9"

                    MDFloatLayout:
                        Image:
                            source: "assets/dark-onboarding_unlimited_wallets.png"
                            pos_hint: {"center_x": .5, "center_y": .7}
                            size_hint: .66, .66
                            #size_hint: .42, .42
                        MDLabel:
                            text: "[b]Unlimited wallets[/b]"
                            markup: True
                            #pos_hint: {"center_y": .58}
                            pos_hint: {"center_y": .485}
                            halign: "center"
                            font_size: "25sp"
                            color: rgba(1, 3, 23, 225)
                        MDLabel:
                            margin: "8dp"
                            pos_hint: {"center_y": .34}
                            opacity: 0.95
                            halign: 'center'
                            font_size: '16sp'
                            text: "Unlimited wallets can be accessed.\n\nAny combination of salt and a passphrase\nwill result in a new, independent wallet."
                        MDTextButton:
                            text: "SKIP AND CONNECT TO BITCOIN"
                            font_size: '18sp'
                            text_color: "black"
                            pos_hint: {"center_x": .5, "center_y": .136}
                            halign: "center"
                            color: "#c9c9c9"
                            on_release: app.goto_slide('login')
                        MDLabel:
                            text: "– of –"
                            pos_hint: {"center_y": .055}
                            halign: "center"
                            font_size: "14sp"
                            color: "#c9c9c9"


                    MDFloatLayout:
                        name: "login"
                        id: id_login
                        AnchorLayout:
                            BoxLayout:
                                size_hint: 0.8, 0.55 # 0.8, 0.55
                                spacing: 3
                                orientation: "vertical"
                                MDTextField:
                                    id: email_field
                                    hint_text: "Email/Username/Salt"
                                    color_mode: "accent"
                                    write_tab: False
                                    required: True
                                    font_size: '21sp'
                                PassphraseControlField:
                                    id: pass_field
                                MDTextField:
                                    id: confirm_field
                                    hint_text: "Repeat Passphrase"
                                    color_mode: "accent"
                                    write_tab: False
                                    password: True
                                    required: True
                                    font_size: '21sp'
                                    on_text: app.check_entropy()
                                #BoxLayout:
                                #    MDCheckbox:
                                #        id: use_multisig
                                #        size_hint: None, None
                                #        size:  dp(33), dp(33)
                                #    MDLabel:
                                #        text: "2-of-3 multisig wallet"
                                #        theme_text_color: "Primary"
                                #        font_style:"Caption"
                                #        size_hint_y: None
                                #        height: dp(36)
                                MDLabel:
                                    id: passphrase_hint
                                    text: "WARNING: Use a better passphrase!"
                                    halign: "center"
                                    font_size: "14sp"
                                    color: "#ff0000"
                                MDProgressBar:
                                    id: pass_progress
                                    value: 0
                                    max: 128
                                    size_hint_y:None
                                    height:dp(4)
                                    color: "#ff0000"
                                BoxLayout:
                                    MDCheckbox:
                                        id: bech32_checkbox
                                        size_hint: None, None
                                        size:  dp(33), dp(33)
                                        opacity: 0
                                        active: False
                                        disabled: True #  bech32 implementation seems broken right now. not sure if it ever worked
                                MDRaisedButton:
                                    size_hint_x: 1
                                    text: "Let's get started"
                                    id: login_button
                                    md_bg_color: "#252525"
                                    on_release: app.login()
                                    font_size: '18sp'

                                MDLabel:
                                    size: self.size
                                    opacity: 0.85
                                    halign: 'center'
                                    font_size: '12sp'
                                    pos_hint: {"center_x": .5, "center_y": .115}
                                    text: ""#– OR –"

                                MDTextButton:
                                    text: "Use BIP39 Mnemonic instead".upper()
                                    font_size: '18sp'
                                    text_color: "black"
                                    halign: "center"
                                    pos_hint: {"center_x": .5, "center_y": .1}
                                    color: "#c9c9c9"
                                    on_release: app.goto_slide('login_with_bip39')

                                #MDLabel:
                                #    size: self.size
                                #    opacity: 0.85
                                #    halign: 'center'
                                #    font_size: '12sp'
                                #    text: "\n\n\n\n\n\n\n\n\n\n\nBrainbow is of course offered without any warranty of any kind; if you lose your bitcoin due to a bug in our software, your keystrokes being recorded on a malware-infested device from 2003, a weak passphrase, or even a typo, we are sorry in the most respectful way, but we cannot help you.\n\nJust don't forget your salt and passphrase."
                    MDFloatLayout:
                        name: "login_with_bip39"
                        id: id_login_with_bip39
                        AnchorLayout:
                            BoxLayout:
                                size_hint: 0.8, 0.55 # 0.55
                                spacing: 3
                                orientation: "vertical"
                                MDTextField:
                                    id: bip39_mnemonic
                                    hint_text: "BIP39 Mnemonic (12 or 24 words)"
                                    color_mode: "accent"
                                    write_tab: False
                                    required: False
                                    font_size: '21sp'
                                ##PassphraseControlField:
                                ##    id: pass_field
                                #MDTextField:
                                #    id: bip39_passphrase_field
                                #    hint_text: "BIP39 Passphrase (optional)"
                                #    color_mode: "accent"
                                #    write_tab: False
                                #    password: True
                                #    required: False
                                #    disabled: True
                                #    font_size: '21sp'
                                #MDTextField:
                                #    id: MDTextField:
                                #    id: confirm_bip39_passphrase_field
                                #    hint_text: "Repeat BIP39 Passphrase (optional)"
                                #    color_mode: "accent"
                                #    write_tab: False
                                #    password: True
                                #    required: False
                                #    disabled: True
                                #    font_size: '21sp'
                                MDRaisedButton:
                                    size_hint_x: 1
                                    text: "Let's get started using BIP39"
                                    id: bip39_login_button
                                    md_bg_color: "#252525"
                                    on_release: app.bip39_login()
                                    font_size: '18sp'


                    MDFloatLayout:
                        name: "startup_offline_mode"
                        Image:
                            source: "assets/dark-online.png"
                            id: startup_offline_mode_image_source
                            pos_hint: {"center_x": .5, "center_y": .7}
                            size_hint: .66, .66
                            #size_hint: .42, .42
                        MDLabel:
                            text: "[b]Offline Mode[/b]"
                            markup: True
                            pos_hint: {"center_y": .485}
                            halign: "center"
                            font_size: "25sp"
                            color: rgba(1, 3, 23, 225)
                        MDSwitch:
                            size_hint: None, None
                            size: "48dp", "48dp"
                            pos_hint: {"center_x": .5, "center_y": .4}
                            on_active: app.on_offline_switch_active(*args)
                        MDLabel:
                            margin: "8dp"
                            pos_hint: {"center_y": .3}
                            opacity: 0.95
                            halign: 'center'
                            font_size: '16sp'
                            text: "By enabling 'Offline Mode', Brainbow does\nnot establish any network connections."
                        MDLabel:
                            text: "m of n"
                            pos_hint: {"center_y": .055}
                            halign: "center"
                            font_size: "14sp"
                            color: "#c9c9c9"

                    MDFloatLayout:
                        name: "startup_my_electrum"
                        Image:
                            source: "assets/dark-btc-own-node.png"
                            pos_hint: {"center_x": .5, "center_y": .7}
                            size_hint: .66, .66
                            #size_hint: .42, .42
                        MDLabel:
                            text: "[b]Private Electurm Server[/b]"
                            markup: True
                            pos_hint: {"center_y": .485}
                            halign: "center"
                            font_size: "25sp"
                            color: rgba(1, 3, 23, 225)
                        MDSwitch:
                            size_hint: None, None
                            size: "48dp", "48dp"
                            pos_hint: {"center_x": .5, "center_y": .4}

                        MDLabel:
                            margin: "8dp"
                            pos_hint: {"center_y": .225}
                            opacity: 0.95
                            halign: 'center'
                            font_size: '16sp'
                            text: "By enabling 'Private Electurm Server', Brainbow\nwill connect to the given Electrum Server only.\n\nWhen disabled, Brainbow connects to a random\npublic server that can see your transactions."

                        MDLabel:
                            text: "m of n"
                            pos_hint: {"center_y": .055}
                            halign: "center"
                            font_size: "14sp"
                            color: "#c9c9c9"







            MainScreen:
                name: "main"
                id: main
                MDTabs
                    tab_display_mode: "icons"
                    on_tab_switch: app.give_current_tab_name(*args)
                    #on_slide_progress: print('hello')
                    background_color: "#4d4d4d"
                #    underline_color: "#f7931a"
                    tab_bar_height:  dp(52)
                    id: main_tabs
                    Tab:
                        name: "balance"
                        title: "TRANSACTIONS"
                        title_icon_mode: "Top"
                        icon: "database-check"
                        BoxLayout:
                            orientation: "vertical"
                            BalanceLabel:
                                id: balance_label
                                font_style: "H4"
                                theme_text_color: "Primary"
                                halign: "center"
                                size_hint_y: None
                                height: self.texture_size[1] + dp(48)
                                on_release: app.toggle_balance_label()
                            RecycleView:
                                id: recycleView
                                viewclass: "BalanceListItem"
                                RecycleBoxLayout:
                                    default_size: None, dp(56)
                                    default_size_hint: 1, None
                                    size_hint_y: None  # redefinition?
                                    height: self.minimum_height
                                    orientation: "vertical"

                    Tab:
                        name: "send"
                        id: send
                        title: "SEND"
                        title_icon_mode: "Top"
                        icon: "database-export"
                        #icon: "database-arrow-right"
                        AnchorLayout:
                            BoxLayout:
                                size_hint: 0.9, 0.75
                                orientation: "vertical"
                                spacing: 9
                                BoxLayout:
                                    size_hint: 1, 0.2
                                    spacing: 5
                                    FloatInput:
                                        id: spend_amount_input
                                        text: app.current_coin
                                        hint_text: app.units
                                        color_mode: "accent"
                                        write_tab: False
                                        on_text: app.update_amounts(self.text, "coin")
                                        on_text: app.set_amount_error(self.text)
                                        on_text_validate: app.set_amount_error(self.text)
                                        on_focus: app.set_amount_error(self.text)
                                    FloatInput:
                                        id: spend_amount_input_fiat
                                        text: app.current_fiat
                                        hint_text: app.currency
                                        color_mode: "accent"
                                        write_tab: False
                                        on_text: app.update_amounts(self.text, "fiat")
                                MDLabel:
                                    id: send_balance
                                    size_hint: 1, 0.2
                                    theme_text_color: "Primary"
                                    font_style: "H6"
                                BoxLayout:
                                    size_hint: 1, 0.6
                                    spacing: 5
                                    QRScanAddressField:
                                        id: address_input
                                    #MDTextField:
                                    #    id: address_input
                                    #    helper_text: "Enter Address"
                                    #    helper_text_mode: "persistent"
                                    #    color_mode: "accent"
                                    #    write_tab: False
                                    #    on_text: app.set_address_error(self.text)
                                    #    on_text_validate: app.set_address_error(self.text)
                                    #    on_focus: app.set_address_error(self.text)
                                BoxLayout:
                                    size_hint: 1, 0.6
                                    spacing: 25
                                    FloatInput:
                                        id: fee_input
                                        helper_text: "Miner Fee: sat/vbyte"
                                        helper_text_mode: "persistent"
                                        color_mode: "accent"
                                        write_tab: False
                                        disabled: False
                                        #size_hint: None, None
                                        on_text: app.fee_input_handler()
                                        on_focus: if self.focus: app.fee_selection.open()
                                BoxLayout:
                                    size_hint: 1, 0.6
                                    spacing: 5
                                    MDRaisedButton:
                                        id: send_button
                                        #size_hint: 0.5, 1
                                        size_hint_x: 1
                                        text: "Preview Transaction"
                                        font_size: sp(18)
                                        md_bg_color: "#252525"
                                        on_release: asyncio.create_task(app.send_button_handler())
                                #MDBoxLayout:
                                #    id: floating_action_box
                                #    spacing: "56dp"
                                #    adaptive_size: True
                                #    pos_hint: {"center_x": .5, "center_y": .5}
                                #    orientation: "vertical"


                                # Old Button to scan a QR Code
                                #MDFloatingActionButton:
                                #    icon: "qrcode-scan"
                                #    md_bg_color: "#252525"
                                #    opposite_colors: True
                                #    elevation_normal: 8
                                #    pos_hint: {"center_x": 0.5, "center_y": 0.2}
                                #    id: camera_button
                                #    on_release: app.start_qr_scanner()



                                #    MDFloatingActionButton:
                                #        md_bg_color: "#252525"
                                #        icon: "credit-card-scan-outline"
                                #        opposite_colors: True
                                #        pos_hint: {"center_x": 0.5, "center_y": 0.2}
                                #        id: nfc_button
                                #        on_release: app.start_nfc_tap()


                    Tab:
                        name: "receive"
                        title: "RECEIVE"
                        title_icon_mode: "Top"
                        icon: "database-import"
                        AnchorLayout:
                            BoxLayout:
                                size_hint: 0.9, 0.8
                                spacing: 3
                                orientation: "vertical"
                                BoxLayout:
                                    size_hint: 1, 0.2
                                    spacing: 5
                                    FloatInput:
                                        id: receive_amount_input
                                        text: app.current_coin
                                        hint_text: app.units
                                        color_mode: "accent"
                                        write_tab: False
                                        on_text: app.update_amounts(self.text, "coin")
                                    FloatInput:
                                        id: receive_amount_input_fiat
                                        text: app.current_fiat
                                        hint_text: app.currency
                                        color_mode: "accent"
                                        write_tab: False
                                        on_text: app.update_amounts(self.text, "fiat")
                                MDCard:
                                    size_hint: None, None
                                    size: dp(300), dp(320)
                                    pos_hint: {"center_x": 0.5}
                                    BoxLayout:
                                        orientation:"vertical"
                                        padding: dp(10)
                                        spacing: 5
                                        on_touch_down: app.copy_current_address_to_clipboard()
                                        MDLabel:

                                        #MDTextButton:

                                        #MDRectangleFlatIconButton:
                                            #line_color: 0, 0, 0, 0
                                            #icon: 'copy'

                                            id: addr_label
                                            text_color: "#000000"
                                            font_style:"Body2"
                                            size_hint_y: None
                                            height: dp(40)
                                        QRCodeWidget:
                                            id: addr_qrcode
                                            show_border: False

                    Tab:
                        name: "addresses"
                        id: addresses
                        icon: "map-marker-multiple"
                        title: "RECEIVE ADDRESSES"
                        title_icon_mode: "Top"
                        tab_padding: [10, 0, 0,0]
                        BoxLayout:
                            orientation: "vertical"
                            RecycleView:
                                id: addresses_recycle_view
                                viewclass: "AddressListItem" # "TwoLineListItem" #
                                RecycleBoxLayout:
                                    default_size: None, None
                                    default_size_hint: 1, None
                                    size_hint_y: None
                                    height: self.minimum_height
                                    orientation: "vertical"


                    Tab:
                        name: "changeaddresses"
                        id: changeaddresses
                        icon: "map-marker-multiple-outline"
                        title: "CHANGE ADDRESSES"
                        title_icon_mode: "Top"
                        tab_padding: [10, 0, 0,0]
                        BoxLayout:
                            orientation: "vertical"
                            RecycleView:
                                id: changeaddresses_recycle_view
                                viewclass: "AddressListItem" # "TwoLineListItem" #
                                RecycleBoxLayout:
                                    default_size: None, None
                                    default_size_hint: 1, None
                                    size_hint_y: None
                                    height: self.minimum_height
                                    orientation: "vertical"



                    Tab:
                        name: "utxos"
                        icon: "database-marker"
                        title: "UTXOs (Coins)"
                        title_icon_mode: "Top"
                        tab_padding: [10, 0, 0,0]
                        BoxLayout:
                            orientation: "vertical"
                            BalanceLabel:
                                id: utxo_balance_label
                                font_style: "H5"
                            #    text: "UTXO Selection"
                                theme_text_color: "Primary"
                                halign: "center"
                                size_hint_y: None
                                #height: self.texture_size[1] + dp(48)
                                height:dp(12)
                                #on_release: app.toggle_balance_label()
                            RecycleView:
                                id: utxoRecycleView
                                viewclass: "UTXOListItem"
                                RecycleBoxLayout:
                                    tab_padding: [10, 0, 0,0]
                                    default_size: None, None
                                    default_size_hint: 1, None
                                    size_hint_y: None
                                    height: self.minimum_height
                                    orientation: "vertical"

            WaitScreen:
                name: "wait"
                AnchorLayout:
                    MDSpinner:
                        size_hint: None, None
                        size: dp(250), dp(250)
                        pos_hint: {"center_x": 0.5, "center_y": 0.5}
                        palette:
                            [1, 0.25, 0, 1],[1, 0.5, 1, 1],
                        line_width: dp(1.25)
                    MDSpinner:
                        size_hint: None, None
                        size: dp(255), dp(255)
                        pos_hint: {"center_x": 0.5, "center_y": 0.5}
                        palette:
                            [1, 0.5, 0, 1],[.8, 0.25, 1, 1],
                        line_width: dp(1.25)
                    MDSpinner:
                        size_hint: None, None
                        size: dp(260), dp(260)
                        pos_hint: {"center_x": 0.5, "center_y": 0.5}
                        palette:
                            [.8, 0.5, 0, 1],[.6, 0.05, 1, 1],
                        line_width: dp(1.25)
                MDLabel:
                    id: wait_text
                    text: "Loading..."
                    theme_text_color: "Primary"
                    font_style: "H4"
                    size_hint: 0.7, None
                    halign: "center"
                    pos_hint: {"center_x": 0.5, "center_y": 0.5}

                MDLabel:
                    id: wait_text_small
                    size: self.size
                    font_size: '11sp'
                    text: "-"
                    theme_text_color: "Primary"
                    size_hint: 0.7, None
                    halign: "center"
                    pos_hint: {"center_x": 0.5, "center_y": 0.95}



            BlockHeightScreen:
                name: "blockheightscreen"
                MDFloatLayout:
                    BoxLayout:
                        size_hint: 1, 1
                        orientation:"vertical"
                        MDLabel:
                            id: blockheight_lbl
                            text: "[b]000000[/b]"
                            markup: True
                            pos_hint: {"center_y": .485}
                            halign: "center"
                            font_size: "25sp"
                            color: rgba(1, 3, 23, 225)


            ExchangeRateScreen:
                name: "exchangerate"
                MDFloatLayout:
                    BoxLayout:
                        size_hint: 1, 1
                        orientation:"vertical"
                        MDLabel:
                            text: "[b]Live exchange rates, BTC/USD[/b]"
                            markup: True
                            pos_hint: {"center_y": .485}
                            halign: "center"
                            font_size: "25sp"
                            color: rgba(1, 3, 23, 225)
                        MDSwitch:
                            size_hint: None, None
                            size: "48dp", "48dp"
                            pos_hint: {'center_x': .5, 'center_y': .5}
                            on_active: app.on_exchange_rate_switch_active(*args)
                        MDLabel:
                            id: current_btc_exchange_rate
                            halign: "center"
                            text: "1 BTC = 1 BTC"
                            pos_hint: {'center_x': .5, 'center_y': .6}
                        MDLabel:
                            halign: "center"
#                            text: "By activating 'Live exchange rates', Brainbow\nwill get the exchange rates from different\nservices and calculate rate within the app."
                            text: "By enabling 'Live exchange rates', Brainbow\nretrieves the exchange rates from various\nservices and calculates an average rate."
                            pos_hint: {'center_x': .5, 'center_y': .65}





            YPUBScreen:
                name: "ypub"
                MDCard:
                    size_hint: None, None
                    size: dp(320), dp(360)
                    pos_hint: {"center_x": 0.5, "center_y": 0.55}
                    BoxLayout:
                        orientation:"vertical"
                        padding: dp(10)
                        spacing: 5
                        MDLabel:
                            id: ypub_label
                            theme_text_color: "ContrastParentBackground"
                            font_style: "Body2"
                            size_hint_y: None
                            height: dp(70)
                        QRCodeWidget:
                            id: ypub_qrcode
                            show_border: False







            SeedScreen:
                name: "seed"
                transition: SlideTransition(direction="right", duration=0.01)
                MDCard:
                    size_hint: None, None
                    size: dp(320), dp(360)
                    pos_hint: {"center_x": 0.5, "center_y": 0.55}
                    BoxLayout:
                        orientation:"vertical"
                        padding: dp(10)
                        spacing: 5
                        MDLabel:
                            id: seed_label
                            theme_text_color: "ContrastParentBackground"
                            font_style:"Body2"
                            size_hint_y: None
                            height: dp(70)
                        QRCodeWidget:
                            id: seed_qrcode
                            show_border: False

            SeedScreen:
                name: "bip39_mnemonic_screen"
                transition: SlideTransition(direction="right", duration=0.01)
                MDCard:
                    size_hint: None, None
                    size: dp(320), dp(360)
                    pos_hint: {"center_x": 0.5, "center_y": 0.55}
                    BoxLayout:
                        orientation:"vertical"
                        padding: dp(10)
                        spacing: 5
                        MDLabel:
                            id: bip39_mnemonic_label
                            theme_text_color: "ContrastParentBackground"
                            font_style:"Body2"
                            size_hint_y: None
                            height: dp(70)
                        QRCodeWidget:
                            id: bip39_mnemonic_qrcode
                            show_border: False




    MDNavigationLayout:
        MDNavigationDrawer:
            id: nav_drawer
            anchor: "left"
            padding: 16, 22, 12, 16
            radius: (0, 0, 0, 0)
            md_bg_color: "#ffffff"
            MDNavigationDrawerMenu:
                MDNavigationDrawerHeader:
                    title: "Brainbow"
                    text: "(no active wallet)"
                    text_color: "#c9c9c9"
                    id: active_wallet_alias
                    padding: "12dp", 0, 0, "56dp"

                MDNavigationDrawerItem:
                    icon: "database-import"
                    text: "Receive"
                    on_release: app.goto_screen('main', 'RECEIVE')

                MDNavigationDrawerItem:
                    icon: "database-export"
                    text: "Send"
                    on_release: app.goto_screen('main', 'SEND')

                MDNavigationDrawerItem:
                    icon: "database-check"
                    right_text: ""
                    text_right_color: "#4a4939"
                    text: "Transactions"
                    #text_color: "#c9c9c9"
                    #selected_color: "#c9c9c9"
                    id: nav_drawer_item_transactions
                    on_release: app.goto_screen('main', 'TRANSACTIONS')



                MDNavigationDrawerDivider:

                #MDNavigationDrawerItem:
                #    icon: "cellphone-nfc"
                #    text: "Test Bottom Sheed"
                #    on_release: app.open_sheet()



                MDNavigationDrawerItem:
                    icon: "map-marker-multiple"
                    text: "Receive Addresses"
                    on_release: app.goto_screen('main', 'RECEIVE ADDRESSES')

                MDNavigationDrawerItem:
                    icon: "map-marker-multiple-outline"
                    text: "Change Addresses"
                    on_release: app.goto_screen('main', 'CHANGE ADDRESSES')

                MDNavigationDrawerItem:
                    icon: "database-marker"
                    text: "UTXOs (Coins)"
                    on_release: app.goto_screen('main', "UTXOs (Coins)")

                    # on_release: app.nfc_toggle()

                #MDNavigationDrawerLabel:
                #    text: "Labels"
                #    spacing: "16dp"



                MDNavigationDrawerDivider:

                MDNavigationDrawerLabel:
                    text: "Current Session and State"

                #MDNavigationDrawerLabel:
                #    text: "Help and Feedback"
                #MDNavigationDrawerItem:
                #    icon: "twitter"
                #    text: "Twitter @bitcoinbrainbow"

                #MDNavigationDrawerLabel:
                #    text: "Version: 0.0.1.testnet"
                #    text_color: "#c9c9c9"

                #MDNavigationDrawerDivider:

                #MDNavigationDrawerItem:
                #    icon: "cellphone-nfc"
                #    text: "NFC On/Off"
                #    on_release: app.nfc_toggle()

                #MDNavigationDrawerItem:
                #    icon: "database-cog"
                #    text: "Settings"

                MDNavigationDrawerItem:
                    icon: "counter"
                    text: "Block Height"
                    on_release: app.load_blockheight_view()


                MDNavigationDrawerItem:
                    icon: "cash-100"
                    text: "Live Exchange Rates"
                    on_release: app.load_exchangerate_view()

                MDNavigationDrawerDivider:


                MDNavigationDrawerLabel:
                    text: "Wallet Information and Export"

                MDNavigationDrawerItem:
                    icon: "database-arrow-down-outline"
                    text: "Extended Public Key"
                    on_release: app.load_pubkey_view()

                MDNavigationDrawerItem:
                    icon: "database-arrow-down"
                    text: "Wallet Import Format"
                    on_release: app.load_seed_view()

                MDNavigationDrawerItem:
                    icon: "database-arrow-down"
                    text: "BIP39 Mnemonic"
                    on_release: app.load_bip39_mnemonic_view()

                MDNavigationDrawerItem:
                    icon: "database-off"
                    text: "Disconnet Wallet and Exit"
                    on_release: app.logoff()

                MDNavigationDrawerDivider:

                MDNavigationDrawerLabel:
                    id: active_wallet_version
                    text: ""



    MDNavigationLayout:
        MDNavigationDrawer:
            id: onboarding_drawer
            anchor: "right"
            padding: 16, 22, 12, 16
            radius: (0, 0, 0, 0)
            #md_bg_color: "#ffffff"
            #md_bg_color: app.theme_cls.bg_light
            MDNavigationDrawerMenu:


                MDNavigationDrawerHeader:
                    title: "Brainbow"
                    text: "On-boarding"
                    padding: "12dp", 0, 0, "56dp"


                #MDNavigationDrawerLabel:
                #    text: "Information"

                MDNavigationDrawerItem:
                    text: "Welcome to Brainbow"
                    on_release: pass

                MDNavigationDrawerItem:
                    text: "Access your wallet"
                    on_release: pass
                MDNavigationDrawerItem:
                    text: "Protect your wallet"
                    on_release: pass
                MDNavigationDrawerItem:
                    text: "What salt is"
                    text_color: "#000000"
                    on_release: app.goto_slide('salt_is')
                MDNavigationDrawerItem:
                    text: "What a passphrase is"
                    on_release: pass
                MDNavigationDrawerItem:
                    text: "Unlimited wallets"
                    on_release: pass



                MDNavigationDrawerDivider:
                MDNavigationDrawerLabel:
                    text: "Wallet Access"

                MDNavigationDrawerItem:
                    icon: "form-textbox-password"
                    text: "Connect to Bitcoin"
                    #text_color: app.theme_cls.primary_dark
                    on_release: app.goto_slide('login')
                MDNavigationDrawerItem:
                    icon: "format-columns"
                    text: "Use BIP39 Mnemonic"
                    on_release: app.goto_slide('login_with_bip39')

                MDNavigationDrawerDivider:
                MDNavigationDrawerLabel:
                    text: "Advanced Settings"

                MDNavigationDrawerItem:
                    icon: "toggle-switch-off"
                    text: "Offline Mode"
                MDNavigationDrawerItem:
                    icon: "toggle-switch-off"
                    text: "Private Electrum Server"
                MDNavigationDrawerItem:
                    icon: "toggle-switch-off"
                    text: "Live Exchange Rates"
